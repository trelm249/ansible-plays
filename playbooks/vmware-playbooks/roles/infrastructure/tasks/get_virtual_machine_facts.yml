---
- name: Get the Virtual Machines in VCenter
  vmware_vm_info:
    validate_certs: no
    hostname: "{{ VC_HOSTNAME }}"
    username: "{{ VCUSER }}"
    password: "{{ VCPASS }}"
  register: virtual_machine_facts
  tags:
    - guests
    - instances

#- debug: msg="{{ vm_lists['virtual_machines'].keys() }}"
- debug: msg="{{ virtual_machine_facts.virtual_machines }}"

- name: write output to a file
  lineinfile:
    create: yes
    regexp: "NONEEXISTENTLINE"
    path: ./log/virtual_machine_facts.{{ ansible_date_time.date }}.json
    line: "{{ virtual_machine_facts.virtual_machines | to_nice_json }}"
...

